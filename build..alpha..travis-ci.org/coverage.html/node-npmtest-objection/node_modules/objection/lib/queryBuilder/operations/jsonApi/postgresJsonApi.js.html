<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-objection/node_modules/objection/lib/queryBuilder/operations/jsonApi/postgresJsonApi.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-objection">npmtest-objection (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-objection/node_modules/objection/lib/queryBuilder/operations/jsonApi/postgresJsonApi.js</span></h1>
    <h2>
        
        Statements: <span class="metric">24.62% <small>(16 / 65)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">13.79% <small>(4 / 29)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">12.5% <small>(1 / 8)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">23.44% <small>(15 / 64)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-objection/node_modules/objection/lib/queryBuilder/operations/jsonApi/</a> &#187; postgresJsonApi.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
&nbsp;
Object.defineProperty(exports, "__esModule", {
  value: true
});
&nbsp;
var _stringify = require('babel-runtime/core-js/json/stringify');
&nbsp;
var _stringify2 = _interopRequireDefault(_stringify);
&nbsp;
var _lodash = require('lodash');
&nbsp;
var _lodash2 = _interopRequireDefault(_lodash);
&nbsp;
var _jsonFieldExpressionParser = require('../../parsers/jsonFieldExpressionParser');
&nbsp;
var _jsonFieldExpressionParser2 = _interopRequireDefault(_jsonFieldExpressionParser);
&nbsp;
function _interopRequireDefault(obj) { return obj &amp;&amp; obj.__esModule ? obj : { default: obj }; }
&nbsp;
/**
 * @typedef {String} FieldExpression
 *
 * Field expressions allow one to refer to separate JSONB fields inside columns.
 *
 * Syntax: &lt;column reference&gt;[:&lt;json field reference&gt;]
 *
 * e.g. `Person.jsonColumnName:details.names[1]` would refer to value `'Second'`
 * in column `Person.jsonColumnName` which has
 * `{ details: { names: ['First', 'Second', 'Last'] } }` object stored in it.
 *
 * First part `&lt;column reference&gt;` is compatible with column references used in
 * knex e.g. `MyFancyTable.tributeToThBestColumnNameEver`.
 *
 * Second part describes a path to an attribute inside the referred column.
 * It is optional and it always starts with colon which follows directly with
 * first path element. e.g. `Table.jsonObjectColumnName:jsonFieldName` or
 * `Table.jsonArrayColumn:[321]`.
 *
 * Syntax supports `[&lt;key or index&gt;]` and `.&lt;key or index&gt;` flavors of reference
 * to json keys / array indexes:
 *
 * e.g. both `Table.myColumn:[1][3]` and `Table.myColumn:1.3` would access correctly
 * both of the following objects `[null, [null,null,null, "I was accessed"]]` and
 * `{ "1": { "3" : "I was accessed" } }`
 *
 * Caveats when using special characters in keys:
 *
 * 1. `objectColumn.key` This is the most common syntax, good if you are
 *    not using dots or square brackets `[]` in your json object key name.
 * 2. Keys containing dots `objectColumn:[keywith.dots]` Column `{ "keywith.dots" : "I was referred" }`
 * 3. Keys containing square brackets `column['[]']` `{ "[]" : "This is getting ridiculous..." }`
 * 4. Keys containing square brackets and quotes
 *    `objectColumn:['Double."Quote".[]']` and `objectColumn:["Sinlge.'Quote'.[]"]`
 *    Column `{ "Double.\"Quote\".[]" : "I was referred",  "Single.'Quote'.[]" : "Mee too!" }`
 * 99. Keys containing dots, square brackets, single quotes and double quotes in one json key is
 *     not currently supported
 */
&nbsp;
exports.default = {
  parseFieldExpression: parseFieldExpression,
  whereJsonbRefOnLeftJsonbValOrRefOnRight: whereJsonbRefOnLeftJsonbValOrRefOnRight,
  whereJsonbRefOnLeftJsonbValOrRefOnRightRawQueryParams: whereJsonbRefOnLeftJsonbValOrRefOnRightRawQueryParams,
  whereJsonFieldRightStringArrayOnLeftQuery: whereJsonFieldRightStringArrayOnLeftQuery,
  whereJsonFieldQuery: whereJsonFieldQuery
};
&nbsp;
&nbsp;
<span class="fstat-no" title="function not covered" >function parseFieldExpression(expression, extractAsText) {</span>
<span class="cstat-no" title="statement not covered" >  var parsed = _jsonFieldExpressionParser2.default.parse(expression);</span>
<span class="cstat-no" title="statement not covered" >  var jsonRefs = (0, _lodash2.default)(parsed.access).map('ref').value().join(",");</span>
<span class="cstat-no" title="statement not covered" >  var extractor = extractAsText ? '#&gt;&gt;' : '#&gt;';</span>
<span class="cstat-no" title="statement not covered" >  var middleQuotedColumnName = parsed.columnName.split('.').join('"."');</span>
<span class="cstat-no" title="statement not covered" >  return '"' + middleQuotedColumnName + '"' + extractor + '\'{' + jsonRefs + '}\'';</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function whereJsonbRefOnLeftJsonbValOrRefOnRight(builder, fieldExpression, operator, jsonObjectOrFieldExpression, queryPrefix) {</span>
<span class="cstat-no" title="statement not covered" >  var queryParams = whereJsonbRefOnLeftJsonbValOrRefOnRightRawQueryParams(fieldExpression, operator, jsonObjectOrFieldExpression, queryPrefix);</span>
<span class="cstat-no" title="statement not covered" >  return builder.whereRaw.apply(builder, queryParams);</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function whereJsonbRefOnLeftJsonbValOrRefOnRightRawQueryParams(fieldExpression, operator, jsonObjectOrFieldExpression, queryPrefix) {</span>
<span class="cstat-no" title="statement not covered" >  var fieldReference = parseFieldExpression(fieldExpression);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (_lodash2.default.isString(jsonObjectOrFieldExpression)) {</span>
<span class="cstat-no" title="statement not covered" >    var rightHandReference = parseFieldExpression(jsonObjectOrFieldExpression);</span>
<span class="cstat-no" title="statement not covered" >    var refRefQuery = ["(", fieldReference, ")::jsonb", operator, "(", rightHandReference, ")::jsonb"];</span>
<span class="cstat-no" title="statement not covered" >    if (queryPrefix) {</span>
<span class="cstat-no" title="statement not covered" >      refRefQuery.unshift(queryPrefix);</span>
    }
<span class="cstat-no" title="statement not covered" >    return [refRefQuery.join(" ")];</span>
  } else <span class="cstat-no" title="statement not covered" >if (_lodash2.default.isObject(jsonObjectOrFieldExpression)) {</span>
<span class="cstat-no" title="statement not covered" >    var refValQuery = ["(", fieldReference, ")::jsonb", operator, "?::jsonb"];</span>
<span class="cstat-no" title="statement not covered" >    if (queryPrefix) {</span>
<span class="cstat-no" title="statement not covered" >      refValQuery.unshift(queryPrefix);</span>
    }
<span class="cstat-no" title="statement not covered" >    return [refValQuery.join(" "), (0, _stringify2.default)(jsonObjectOrFieldExpression)];</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  throw new Error("Invalid right hand expression.");</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function whereJsonFieldRightStringArrayOnLeftQuery(builder, fieldExpression, operator, keys) {</span>
<span class="cstat-no" title="statement not covered" >  var knex = builder._knex;</span>
<span class="cstat-no" title="statement not covered" >  var fieldReference = parseFieldExpression(fieldExpression);</span>
<span class="cstat-no" title="statement not covered" >  keys = _lodash2.default.isArray(keys) ? keys : [keys];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var questionMarksArray = _lodash2.default.map(keys, <span class="fstat-no" title="function not covered" >function (key) {</span></span>
<span class="cstat-no" title="statement not covered" >    if (!_lodash2.default.isString(key)) {</span>
<span class="cstat-no" title="statement not covered" >      throw new Error("All keys to find must be strings.");</span>
    }
<span class="cstat-no" title="statement not covered" >    return "?";</span>
  });
&nbsp;
<span class="cstat-no" title="statement not covered" >  var rawSqlTemplateString = "array[" + questionMarksArray.join(",") + "]";</span>
<span class="cstat-no" title="statement not covered" >  var rightHandExpression = knex.raw(rawSqlTemplateString, keys);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  return fieldReference + ' ' + operator.replace('?', '\\?') + ' ' + rightHandExpression;</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function whereJsonFieldQuery(knex, fieldExpression, operator, value) {</span>
<span class="cstat-no" title="statement not covered" >  var fieldReference = parseFieldExpression(fieldExpression, true);</span>
<span class="cstat-no" title="statement not covered" >  var normalizedOperator = normalizeOperator(knex, operator);</span>
&nbsp;
  // json type comparison takes json type in string format
<span class="cstat-no" title="statement not covered" >  var cast = void 0;</span>
<span class="cstat-no" title="statement not covered" >  var escapedValue = knex.raw(" ?", [value]);</span>
<span class="cstat-no" title="statement not covered" >  if (_lodash2.default.isNumber(value)) {</span>
<span class="cstat-no" title="statement not covered" >    cast = "::NUMERIC";</span>
  } else <span class="cstat-no" title="statement not covered" >if (_lodash2.default.isBoolean(value)) {</span>
<span class="cstat-no" title="statement not covered" >    cast = "::BOOLEAN";</span>
  } else <span class="cstat-no" title="statement not covered" >if (_lodash2.default.isString(value)) {</span>
<span class="cstat-no" title="statement not covered" >    cast = "::TEXT";</span>
  } else <span class="cstat-no" title="statement not covered" >if (_lodash2.default.isNull(value)) {</span>
<span class="cstat-no" title="statement not covered" >    cast = "::TEXT";</span>
<span class="cstat-no" title="statement not covered" >    escapedValue = 'NULL';</span>
  } else {
<span class="cstat-no" title="statement not covered" >    throw new Error("Value must be string, number, boolean or null.");</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  return '(' + fieldReference + ')' + cast + ' ' + normalizedOperator + ' ' + escapedValue;</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function normalizeOperator(knex, operator) {</span>
<span class="cstat-no" title="statement not covered" >  var trimmedLowerCase = operator.trim().toLowerCase();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  switch (trimmedLowerCase) {</span>
    case "is":
    case "is not":
<span class="cstat-no" title="statement not covered" >      return trimmedLowerCase;</span>
    default:
<span class="cstat-no" title="statement not covered" >      return knex.client.formatter().operator(operator);</span>
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBvc3RncmVzSnNvbkFwaS5qcyJdLCJuYW1lcyI6WyJwYXJzZUZpZWxkRXhwcmVzc2lvbiIsIndoZXJlSnNvbmJSZWZPbkxlZnRKc29uYlZhbE9yUmVmT25SaWdodCIsIndoZXJlSnNvbmJSZWZPbkxlZnRKc29uYlZhbE9yUmVmT25SaWdodFJhd1F1ZXJ5UGFyYW1zIiwid2hlcmVKc29uRmllbGRSaWdodFN0cmluZ0FycmF5T25MZWZ0UXVlcnkiLCJ3aGVyZUpzb25GaWVsZFF1ZXJ5IiwiZXhwcmVzc2lvbiIsImV4dHJhY3RBc1RleHQiLCJwYXJzZWQiLCJwYXJzZSIsImpzb25SZWZzIiwiYWNjZXNzIiwibWFwIiwidmFsdWUiLCJqb2luIiwiZXh0cmFjdG9yIiwibWlkZGxlUXVvdGVkQ29sdW1uTmFtZSIsImNvbHVtbk5hbWUiLCJzcGxpdCIsImJ1aWxkZXIiLCJmaWVsZEV4cHJlc3Npb24iLCJvcGVyYXRvciIsImpzb25PYmplY3RPckZpZWxkRXhwcmVzc2lvbiIsInF1ZXJ5UHJlZml4IiwicXVlcnlQYXJhbXMiLCJ3aGVyZVJhdyIsImFwcGx5IiwiZmllbGRSZWZlcmVuY2UiLCJpc1N0cmluZyIsInJpZ2h0SGFuZFJlZmVyZW5jZSIsInJlZlJlZlF1ZXJ5IiwidW5zaGlmdCIsImlzT2JqZWN0IiwicmVmVmFsUXVlcnkiLCJFcnJvciIsImtleXMiLCJrbmV4IiwiX2tuZXgiLCJpc0FycmF5IiwicXVlc3Rpb25NYXJrc0FycmF5Iiwia2V5IiwicmF3U3FsVGVtcGxhdGVTdHJpbmciLCJyaWdodEhhbmRFeHByZXNzaW9uIiwicmF3IiwicmVwbGFjZSIsIm5vcm1hbGl6ZWRPcGVyYXRvciIsIm5vcm1hbGl6ZU9wZXJhdG9yIiwiY2FzdCIsImVzY2FwZWRWYWx1ZSIsImlzTnVtYmVyIiwiaXNCb29sZWFuIiwiaXNOdWxsIiwidHJpbW1lZExvd2VyQ2FzZSIsInRyaW0iLCJ0b0xvd2VyQ2FzZSIsImNsaWVudCIsImZvcm1hdHRlciJdLCJtYXBwaW5ncyI6Ijs7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QUFDRCxHQUhNLE1BR0E7QUFDTCxVQUFNLElBQUlkLEtBQUosQ0FBVSxnREFBVixDQUFOO0FBQ0Q7O0FBRUQsZUFBV1AsY0FBWCxTQUE2Qm9CLElBQTdCLFNBQXFDRixrQkFBckMsU0FBMkRHLFlBQTNEO0FBQ0Q7O0FBRUQsU0FBU0YsaUJBQVQsQ0FBMkJWLElBQTNCLEVBQWlDZixRQUFqQyxFQUEyQztBQUN6QyxNQUFJK0IsbUJBQW1CL0IsU0FBU2dDLElBQVQsR0FBZ0JDLFdBQWhCLEVBQXZCOztBQUVBLFVBQVFGLGdCQUFSO0FBQ0UsU0FBSyxJQUFMO0FBQ0EsU0FBSyxRQUFMO0FBQ0UsYUFBT0EsZ0JBQVA7QUFDRjtBQUNFLGFBQU9oQixLQUFLbUIsTUFBTCxDQUFZQyxTQUFaLEdBQXdCbkMsUUFBeEIsQ0FBaUNBLFFBQWpDLENBQVA7QUFMSjtBQU9EIiwiZmlsZSI6InBvc3RncmVzSnNvbkFwaS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQganNvbkZpZWxkRXhwcmVzc2lvblBhcnNlciBmcm9tICcuLi8uLi9wYXJzZXJzL2pzb25GaWVsZEV4cHJlc3Npb25QYXJzZXInO1xuXG4vKipcbiAqIEB0eXBlZGVmIHtTdHJpbmd9IEZpZWxkRXhwcmVzc2lvblxuICpcbiAqIEZpZWxkIGV4cHJlc3Npb25zIGFsbG93IG9uZSB0byByZWZlciB0byBzZXBhcmF0ZSBKU09OQiBmaWVsZHMgaW5zaWRlIGNvbHVtbnMuXG4gKlxuICogU3ludGF4OiA8Y29sdW1uIHJlZmVyZW5jZT5bOjxqc29uIGZpZWxkIHJlZmVyZW5jZT5dXG4gKlxuICogZS5nLiBgUGVyc29uLmpzb25Db2x1bW5OYW1lOmRldGFpbHMubmFtZXNbMV1gIHdvdWxkIHJlZmVyIHRvIHZhbHVlIGAnU2Vjb25kJ2BcbiAqIGluIGNvbHVtbiBgUGVyc29uLmpzb25Db2x1bW5OYW1lYCB3aGljaCBoYXNcbiAqIGB7IGRldGFpbHM6IHsgbmFtZXM6IFsnRmlyc3QnLCAnU2Vjb25kJywgJ0xhc3QnXSB9IH1gIG9iamVjdCBzdG9yZWQgaW4gaXQuXG4gKlxuICogRmlyc3QgcGFydCBgPGNvbHVtbiByZWZlcmVuY2U+YCBpcyBjb21wYXRpYmxlIHdpdGggY29sdW1uIHJlZmVyZW5jZXMgdXNlZCBpblxuICoga25leCBlLmcuIGBNeUZhbmN5VGFibGUudHJpYnV0ZVRvVGhCZXN0Q29sdW1uTmFtZUV2ZXJgLlxuICpcbiAqIFNlY29uZCBwYXJ0IGRlc2NyaWJlcyBhIHBhdGggdG8gYW4gYXR0cmlidXRlIGluc2lkZSB0aGUgcmVmZXJyZWQgY29sdW1uLlxuICogSXQgaXMgb3B0aW9uYWwgYW5kIGl0IGFsd2F5cyBzdGFydHMgd2l0aCBjb2xvbiB3aGljaCBmb2xsb3dzIGRpcmVjdGx5IHdpdGhcbiAqIGZpcnN0IHBhdGggZWxlbWVudC4gZS5nLiBgVGFibGUuanNvbk9iamVjdENvbHVtbk5hbWU6anNvbkZpZWxkTmFtZWAgb3JcbiAqIGBUYWJsZS5qc29uQXJyYXlDb2x1bW46WzMyMV1gLlxuICpcbiAqIFN5bnRheCBzdXBwb3J0cyBgWzxrZXkgb3IgaW5kZXg+XWAgYW5kIGAuPGtleSBvciBpbmRleD5gIGZsYXZvcnMgb2YgcmVmZXJlbmNlXG4gKiB0byBqc29uIGtleXMgLyBhcnJheSBpbmRleGVzOlxuICpcbiAqIGUuZy4gYm90aCBgVGFibGUubXlDb2x1bW46WzFdWzNdYCBhbmQgYFRhYmxlLm15Q29sdW1uOjEuM2Agd291bGQgYWNjZXNzIGNvcnJlY3RseVxuICogYm90aCBvZiB0aGUgZm9sbG93aW5nIG9iamVjdHMgYFtudWxsLCBbbnVsbCxudWxsLG51bGwsIFwiSSB3YXMgYWNjZXNzZWRcIl1dYCBhbmRcbiAqIGB7IFwiMVwiOiB7IFwiM1wiIDogXCJJIHdhcyBhY2Nlc3NlZFwiIH0gfWBcbiAqXG4gKiBDYXZlYXRzIHdoZW4gdXNpbmcgc3BlY2lhbCBjaGFyYWN0ZXJzIGluIGtleXM6XG4gKlxuICogMS4gYG9iamVjdENvbHVtbi5rZXlgIFRoaXMgaXMgdGhlIG1vc3QgY29tbW9uIHN5bnRheCwgZ29vZCBpZiB5b3UgYXJlXG4gKiAgICBub3QgdXNpbmcgZG90cyBvciBzcXVhcmUgYnJhY2tldHMgYFtdYCBpbiB5b3VyIGpzb24gb2JqZWN0IGtleSBuYW1lLlxuICogMi4gS2V5cyBjb250YWluaW5nIGRvdHMgYG9iamVjdENvbHVtbjpba2V5d2l0aC5kb3RzXWAgQ29sdW1uIGB7IFwia2V5d2l0aC5kb3RzXCIgOiBcIkkgd2FzIHJlZmVycmVkXCIgfWBcbiAqIDMuIEtleXMgY29udGFpbmluZyBzcXVhcmUgYnJhY2tldHMgYGNvbHVtblsnW10nXWAgYHsgXCJbXVwiIDogXCJUaGlzIGlzIGdldHRpbmcgcmlkaWN1bG91cy4uLlwiIH1gXG4gKiA0LiBLZXlzIGNvbnRhaW5pbmcgc3F1YXJlIGJyYWNrZXRzIGFuZCBxdW90ZXNcbiAqICAgIGBvYmplY3RDb2x1bW46WydEb3VibGUuXCJRdW90ZVwiLltdJ11gIGFuZCBgb2JqZWN0Q29sdW1uOltcIlNpbmxnZS4nUXVvdGUnLltdXCJdYFxuICogICAgQ29sdW1uIGB7IFwiRG91YmxlLlxcXCJRdW90ZVxcXCIuW11cIiA6IFwiSSB3YXMgcmVmZXJyZWRcIiwgIFwiU2luZ2xlLidRdW90ZScuW11cIiA6IFwiTWVlIHRvbyFcIiB9YFxuICogOTkuIEtleXMgY29udGFpbmluZyBkb3RzLCBzcXVhcmUgYnJhY2tldHMsIHNpbmdsZSBxdW90ZXMgYW5kIGRvdWJsZSBxdW90ZXMgaW4gb25lIGpzb24ga2V5IGlzXG4gKiAgICAgbm90IGN1cnJlbnRseSBzdXBwb3J0ZWRcbiAqL1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gIHBhcnNlRmllbGRFeHByZXNzaW9uLFxuICB3aGVyZUpzb25iUmVmT25MZWZ0SnNvbmJWYWxPclJlZk9uUmlnaHQsXG4gIHdoZXJlSnNvbmJSZWZPbkxlZnRKc29uYlZhbE9yUmVmT25SaWdodFJhd1F1ZXJ5UGFyYW1zLFxuICB3aGVyZUpzb25GaWVsZFJpZ2h0U3RyaW5nQXJyYXlPbkxlZnRRdWVyeSxcbiAgd2hlcmVKc29uRmllbGRRdWVyeVxufVxuXG5mdW5jdGlvbiBwYXJzZUZpZWxkRXhwcmVzc2lvbihleHByZXNzaW9uLCBleHRyYWN0QXNUZXh0KSB7XG4gIGxldCBwYXJzZWQgPSBqc29uRmllbGRFeHByZXNzaW9uUGFyc2VyLnBhcnNlKGV4cHJlc3Npb24pO1xuICBsZXQganNvblJlZnMgPSBfKHBhcnNlZC5hY2Nlc3MpLm1hcCgncmVmJykudmFsdWUoKS5qb2luKFwiLFwiKTtcbiAgbGV0IGV4dHJhY3RvciA9IGV4dHJhY3RBc1RleHQgPyAnIz4+JyA6ICcjPic7XG4gIGxldCBtaWRkbGVRdW90ZWRDb2x1bW5OYW1lID0gcGFyc2VkLmNvbHVtbk5hbWUuc3BsaXQoJy4nKS5qb2luKCdcIi5cIicpO1xuICByZXR1cm4gYFwiJHttaWRkbGVRdW90ZWRDb2x1bW5OYW1lfVwiJHtleHRyYWN0b3J9J3ske2pzb25SZWZzfX0nYDtcbn1cblxuZnVuY3Rpb24gd2hlcmVKc29uYlJlZk9uTGVmdEpzb25iVmFsT3JSZWZPblJpZ2h0KGJ1aWxkZXIsIGZpZWxkRXhwcmVzc2lvbiwgb3BlcmF0b3IsIGpzb25PYmplY3RPckZpZWxkRXhwcmVzc2lvbiwgcXVlcnlQcmVmaXgpIHtcbiAgbGV0IHF1ZXJ5UGFyYW1zID0gd2hlcmVKc29uYlJlZk9uTGVmdEpzb25iVmFsT3JSZWZPblJpZ2h0UmF3UXVlcnlQYXJhbXMoZmllbGRFeHByZXNzaW9uLCBvcGVyYXRvciwganNvbk9iamVjdE9yRmllbGRFeHByZXNzaW9uLCBxdWVyeVByZWZpeCk7XG4gIHJldHVybiBidWlsZGVyLndoZXJlUmF3LmFwcGx5KGJ1aWxkZXIsIHF1ZXJ5UGFyYW1zKTtcbn1cblxuZnVuY3Rpb24gd2hlcmVKc29uYlJlZk9uTGVmdEpzb25iVmFsT3JSZWZPblJpZ2h0UmF3UXVlcnlQYXJhbXMoZmllbGRFeHByZXNzaW9uLCBvcGVyYXRvciwganNvbk9iamVjdE9yRmllbGRFeHByZXNzaW9uLCBxdWVyeVByZWZpeCkge1xuICBsZXQgZmllbGRSZWZlcmVuY2UgPSBwYXJzZUZpZWxkRXhwcmVzc2lvbihmaWVsZEV4cHJlc3Npb24pO1xuXG4gIGlmIChfLmlzU3RyaW5nKGpzb25PYmplY3RPckZpZWxkRXhwcmVzc2lvbikpIHtcbiAgICBsZXQgcmlnaHRIYW5kUmVmZXJlbmNlID0gcGFyc2VGaWVsZEV4cHJlc3Npb24oanNvbk9iamVjdE9yRmllbGRFeHByZXNzaW9uKTtcbiAgICBsZXQgcmVmUmVmUXVlcnkgPSBbXCIoXCIsIGZpZWxkUmVmZXJlbmNlLCBcIik6Ompzb25iXCIsIG9wZXJhdG9yLCBcIihcIiwgcmlnaHRIYW5kUmVmZXJlbmNlLCBcIik6Ompzb25iXCJdO1xuICAgIGlmIChxdWVyeVByZWZpeCkge1xuICAgICAgcmVmUmVmUXVlcnkudW5zaGlmdChxdWVyeVByZWZpeCk7XG4gICAgfVxuICAgIHJldHVybiBbcmVmUmVmUXVlcnkuam9pbihcIiBcIildO1xuICB9IGVsc2UgaWYgKF8uaXNPYmplY3QoanNvbk9iamVjdE9yRmllbGRFeHByZXNzaW9uKSkge1xuICAgIGxldCByZWZWYWxRdWVyeSA9IFtcIihcIiwgZmllbGRSZWZlcmVuY2UsIFwiKTo6anNvbmJcIiwgb3BlcmF0b3IsIFwiPzo6anNvbmJcIl07XG4gICAgaWYgKHF1ZXJ5UHJlZml4KSB7XG4gICAgICByZWZWYWxRdWVyeS51bnNoaWZ0KHF1ZXJ5UHJlZml4KTtcbiAgICB9XG4gICAgcmV0dXJuIFtyZWZWYWxRdWVyeS5qb2luKFwiIFwiKSwgSlNPTi5zdHJpbmdpZnkoanNvbk9iamVjdE9yRmllbGRFeHByZXNzaW9uKV07XG4gIH1cblxuICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHJpZ2h0IGhhbmQgZXhwcmVzc2lvbi5cIik7XG59XG5cbmZ1bmN0aW9uIHdoZXJlSnNvbkZpZWxkUmlnaHRTdHJpbmdBcnJheU9uTGVmdFF1ZXJ5KGJ1aWxkZXIsIGZpZWxkRXhwcmVzc2lvbiwgb3BlcmF0b3IsIGtleXMpIHtcbiAgbGV0IGtuZXggPSBidWlsZGVyLl9rbmV4O1xuICBsZXQgZmllbGRSZWZlcmVuY2UgPSBwYXJzZUZpZWxkRXhwcmVzc2lvbihmaWVsZEV4cHJlc3Npb24pO1xuICBrZXlzID0gXy5pc0FycmF5KGtleXMpID8ga2V5cyA6IFtrZXlzXTtcblxuICBsZXQgcXVlc3Rpb25NYXJrc0FycmF5ID0gXy5tYXAoa2V5cywgZnVuY3Rpb24gKGtleSkge1xuICAgIGlmICghXy5pc1N0cmluZyhrZXkpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBbGwga2V5cyB0byBmaW5kIG11c3QgYmUgc3RyaW5ncy5cIik7XG4gICAgfVxuICAgIHJldHVybiBcIj9cIjtcbiAgfSk7XG5cbiAgbGV0IHJhd1NxbFRlbXBsYXRlU3RyaW5nID0gXCJhcnJheVtcIiArIHF1ZXN0aW9uTWFya3NBcnJheS5qb2luKFwiLFwiKSArIFwiXVwiO1xuICBsZXQgcmlnaHRIYW5kRXhwcmVzc2lvbiA9IGtuZXgucmF3KHJhd1NxbFRlbXBsYXRlU3RyaW5nLCBrZXlzKTtcblxuICByZXR1cm4gYCR7ZmllbGRSZWZlcmVuY2V9ICR7b3BlcmF0b3IucmVwbGFjZSgnPycsICdcXFxcPycpfSAke3JpZ2h0SGFuZEV4cHJlc3Npb259YDtcbn1cblxuZnVuY3Rpb24gd2hlcmVKc29uRmllbGRRdWVyeShrbmV4LCBmaWVsZEV4cHJlc3Npb24sIG9wZXJhdG9yLCB2YWx1ZSkge1xuICBsZXQgZmllbGRSZWZlcmVuY2UgPSBwYXJzZUZpZWxkRXhwcmVzc2lvbihmaWVsZEV4cHJlc3Npb24sIHRydWUpO1xuICBsZXQgbm9ybWFsaXplZE9wZXJhdG9yID0gbm9ybWFsaXplT3BlcmF0b3Ioa25leCwgb3BlcmF0b3IpO1xuXG4gIC8vIGpzb24gdHlwZSBjb21wYXJpc29uIHRha2VzIGpzb24gdHlwZSBpbiBzdHJpbmcgZm9ybWF0XG4gIGxldCBjYXN0O1xuICBsZXQgZXNjYXBlZFZhbHVlID0ga25leC5yYXcoXCIgP1wiLCBbdmFsdWVdKTtcbiAgaWYgKF8uaXNOdW1iZXIodmFsdWUpKSB7XG4gICAgY2FzdCA9IFwiOjpOVU1FUklDXCI7XG4gIH0gZWxzZSBpZiAoXy5pc0Jvb2xlYW4odmFsdWUpKSB7XG4gICAgY2FzdCA9IFwiOjpCT09MRUFOXCI7XG4gIH0gZWxzZSBpZiAoXy5pc1N0cmluZyh2YWx1ZSkpIHtcbiAgICBjYXN0ID0gXCI6OlRFWFRcIjtcbiAgfSBlbHNlIGlmIChfLmlzTnVsbCh2YWx1ZSkpIHtcbiAgICBjYXN0ID0gXCI6OlRFWFRcIjtcbiAgICBlc2NhcGVkVmFsdWUgPSAnTlVMTCc7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVmFsdWUgbXVzdCBiZSBzdHJpbmcsIG51bWJlciwgYm9vbGVhbiBvciBudWxsLlwiKTtcbiAgfVxuXG4gIHJldHVybiBgKCR7ZmllbGRSZWZlcmVuY2V9KSR7Y2FzdH0gJHtub3JtYWxpemVkT3BlcmF0b3J9ICR7ZXNjYXBlZFZhbHVlfWA7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZU9wZXJhdG9yKGtuZXgsIG9wZXJhdG9yKSB7XG4gIGxldCB0cmltbWVkTG93ZXJDYXNlID0gb3BlcmF0b3IudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG5cbiAgc3dpdGNoICh0cmltbWVkTG93ZXJDYXNlKSB7XG4gICAgY2FzZSBcImlzXCI6XG4gICAgY2FzZSBcImlzIG5vdFwiOlxuICAgICAgcmV0dXJuIHRyaW1tZWRMb3dlckNhc2U7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBrbmV4LmNsaWVudC5mb3JtYXR0ZXIoKS5vcGVyYXRvcihvcGVyYXRvcik7XG4gIH1cbn1cbiJdfQ==
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Thu Apr 20 2017 17:06:13 GMT+0000 (UTC)</div>
</div>
</body>
</html>
